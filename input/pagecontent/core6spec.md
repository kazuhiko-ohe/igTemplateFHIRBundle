

### 電子カルテ情報共有サービスに医療機関から送信するFHIR仕様について
本ページは、国が進めている医療DXのなかでのサービスが検討されている「電子カルテ情報共有サービス」において扱われる、いわゆる「３文書６情報」に含まれる「６情報」を医療機関から送信する際のFHIR仕様に関係する部分を記述したものである。3文書に含まれる6情報に相当する情報については、本仕様の該当部分が適用されるが、3文書のBundle仕様はそれぞれの文書の仕様で規定されており、ここで取り扱わない。


「電子カルテ情報共有サービス」については、<A href="https://www.mhlw.go.jp/content/10808000/001085126.pdf">健康・医療・介護情報利活用検討会 医療情報ネットワークの基盤に関するワーキンググループ とりまとめ(2023/3/29)</a>を参照できる。ただし、<span style="color: red; ">検討が現在進行形で進んでいるため、その後の情報収集は刻々とアップデートされる可能性がある。</span>

#### 送信時の複数リソースデータのまとめ方
##### Bundleリソース（collectionタイプ）の使用

電子カルテ情報共有サービスに医療機関から送信する場合、１回に送信するリソースデータは、複数のリソースデータから構成されるのが普通である。FHIRではこのような送受信のまとめに、複数リソースデータをひとまりにしたひとつのリソースとしてBundleリソースタイプが用意されている。<br>

電子カルテ情報共有サービスに医療機関から送信する場合には、このBundleリソースタイプのひとつのリソースデータを作成し、複数のリソースデータを１回の送信で送信する。電子カルテ情報共有サービスで処理対象となっていないリソースタイプのデータが含まれている場合には、受信側では処理されず破棄される（エラーとはならない）。

Bundleリソースのタイプ（type要素）は"collection"を使用する。<br>
なお、電子カルテ情報共有サービスに６情報を送信する場合には、ひとつのBundlleに格納されるリソースデータ同士を相互に参照する（一方のリソースデータから同じBundle内の他のリソースを参照する）ことはできない。一方、３文書を送信する場合には、文書はそれぞれひとつの”document”タイプのBundleとして作成され、ひとつのBundlleに格納されるリソースデータ同士が相互参照できる。<br>

<span style="color: blue;">[v0.9.8追記]
Bundleリソースのプロファイルは以下を参照すること。</span>

* [CLINS電子カルテ情報共有６情報用　Bundleリソース][JP_Bundle_CLINS]



##### ひとつのBundleリソースに格納できるデータ
1回で送信するひとつのBundleリソースには、<br>
① アレルギー情報および薬剤禁忌情報　AllergyIntoleranceリソース<br>
② 傷病名情報 Conditionリソース<br>
③ 検査結果情報および感染症情報　Observationリソース<br>
④ 処方依頼情報　MedicationRequestリソース<br>
のいずれかひとつのリソースタイプのデータと、患者を識別するためのPatientリソース1個だけを格納する。<br>
リソースの格納順序として、患者を識別するためのPatientリソース1個をまずBundleの最初のentryに格納し、以後は上記①から④のいずれか2ひとつのリソースタイプのデータを1個以上格納する。<br>
複数のリソースタイプのデータをひとつのBundleリソースに混在させて送信することはできない（エラーとなる）。


<span style="color: maroon;">[v0.9.8変更のため取り消し]</span>
~~①から④のどのリソースタイプを格納しているかの情報を明示的に設定するため、Bundleリソースのlink.relation要素に固定値"profile"を、link.url要素に①から④に対応して、それぞれ以下のいずれかの値を設定する。~~

 ~~- "http://jpfhir.jp/fhir/clins/StructureDefinition/JP_AllergyIntolerance_eCS"~~
 ~~- "http://jpfhir.jp/fhir/clins/StructureDefinition/JP_Condition_eCS"~~
 ~~- "http://jpfhir.jp/fhir/clins/StructureDefinition/JP_Observation_LabResult_eCS"~~
 ~~- "http://jpfhir.jp/fhir/eCS/StructureDefinition/JP_MedicationRequest_eCS"~~



<span style="color: blue;">[v0.9.8変更のため追記]①から④のどのリソースタイプを格納しているかの情報を明示的に設定するため、Bundleリソースの　meta.tag.system要素に"http://jpfhir.jp/fhir/clins/BundleResourceType"を,　meta.tag.code要素に①から④に対応して、それぞれ以下のいずれかの値を設定する。</span>

 - "AllergyIntolerance"
 - "Condition"
 - "Observation"
 - "MedicationRequest"
 
　また、1回で送信するひとつのBundleリソースには、ひとりの患者の、同時に１回で報告される一連のデータ（１報告単位のデータ）だけを、すべて漏れなく格納する。異なる報告単位のデータや、異なる患者のデータをひとつのBundleリソースに含めてはならない。
送信側または受信側でデータ検証後に送受信がなされる場合、１報告単位のデータはそのデータ全体がOKとなるか、全体が拒絶されるかどちらかとなる。１報告単位のデータのうち一部だけが検証にパスすることはない。

１報告単位のデータとは、情報種別により次のとおりとする。１報告単位のデータを別々のBundleリソースに分けて作成、送信したり、一部分だけ送信することはできない（検出できないためエラーにはならない）。もし、同じidentifier識別情報を持つBundleリソースが複数回送信された場合、最後に送信されたものだけが有効となり、それより過去に送信されたデータは削除される。

以下の説明では、終了日等とは、削除日、転帰日、完了日など、その患者に登録されていた当該情報がなくなったとされた日を指す。ひとつの当該情報に終了日等が複数種類登録されている場合には、そのうち最も新しい日付の情報とする。

 ①アレルギー情報および薬剤禁忌情報（アレルギー情報等という）<br>
１患者にその時点で登録されているか過去に登録されていたすべてのアレルギー情報等のうち、終了日等が５年以内のもの、および終了日等が存在しないアレルギー情報のすべてが、1報告単位となる。<br>
アレルギー情報と薬剤禁忌情報とは区別しない。

②傷病名情報<br>
１患者にその時点で登録されているか過去に登録されていたすべての傷病名情報のうち、終了日等が５年以内のもの、および終了日等が存在しない傷病名情報のすべてが、1報告単位となる。

③ 検査結果情報および感染症情報<br>
１患者の１回の検査結果報告で報告された一連の検査の結果が1報告単位となる。１回の検査結果報告で感染症情報とそれ以外の検査結果情報とが混在している場合には、それらを区別せずに１報告単位のデータとみなしてよいが、別々の検査結果報告として異なる報告単位のデータとみなしてもよい。ただし、異なる報告単位のデータとするときは、異なるBundle.identifier識別情報とする必要がある。

④ 処方情報<br>
１患者の１回の処方オーダで作成された処方情報が1報告単位となる。通常、ひとつの処方箋に記載される処方情報となる。

##### Bundleリソースを識別するIdentifier要素

Bundleリソースのidentifier要素は、電子カルテ情報共有サービス側で保存される。送信側は、後続の送信においてこのidentifierを指定することで、過去に送信したBundleリソースを指定してそれに含まれていた全データについて削除、更新などの処理を行うことができる。

Bundleリソースのidentifier要素は以下の通りとする。<br>
この仕様を満たすidentifierに加えて、これとは異なるsystem値をもつidentifierは複数存在しても構わない。<br>

Bundle.identifier.system	:  system値として、"http://jpfhir.jp/fhir/clins/bundle-identifier" を設定する。<br>
Bundle.identifier.value	:  以下に記載する\[報告単位識別ID\]　を設定する。

\[報告単位識別ID\]：
次の３つの文字列を半角ハット記号（^）で連携した文字列。
  - 保険医療機関番号10桁：<br>
  　（内訳：都道府県番号２桁、点数表コード（医療機関区分）１桁、医療機関番号７桁）
  -	被保険者個人識別子：<br>
  　（内訳：保険者等番号８桁、被保険者証（手帳）等の記号、被保険者証（手帳）等の番号、被保険者証等枝番２桁を半角コロンで結合した文字列）
    <br>
    　　最大51文字（全角38文字＋半角13文字、全角19文字＋半角32文字、または半角51文字）
  - 報告単位のデータを医療機関のシステムとして医療機関内で一意に識別できる粒度のID文字列：<br>
  　　当該システムが当該患者データの中で一意性を保証できるよう生成した半角文字列（英大文字、数字、ハイフン記号のみ可）<br>
  　　最大128文字とすること。




##### Bundleリソース・インスタンスの例（JSON形式）：


```
{
    "resourceType": "Bundle",
    "id": "Bundle-for-Example01",
    "meta": 
      {
        :
        <省略>
        :
      },
    "identifier": [
      {
        "system": "http://jpfhir.jp/fhir/clins/bundle-identifier"
        "value": "1311234567^87654321:あいう:333444:05^ORDLAB-20230301O102930492039"
      },
        :
        <省略>
        :
    ],
    "type": "collection",
    "timestamp": "2020-08-21T12:12:21+09:00",
    "entry": [
        {
            "fullUrl": "urn:uuid:6050a046-8f36-5064-c231-3aeacbc0c883",
            "resource": {
                "resourceType": "Patient",
                "id": "JP-Patient-10293894",
                :
                <患者基本情報を格納するPatientリソース内容>
                :
            }
        },

        {
            "fullUrl": "urn:uuid:6050a046-8f36-5064-c231-3aeacbc0c886",
            "resource": {
                "resourceType": "Observation",
                "id": "JP-Observation-Example001",
                :
                <１個目の検査結果><省略>
                :
            }
        },
        {
            "fullUrl": "urn:uuid:0c83b8af-ba92-5c73-e84e-c719f232cc61",
            "resource": {
                "resourceType": "Observation",
                "id": "JP-Observation-Example001",
                :
                <２個目の検査結果><省略>
                :
            }
        },
        {
            "fullUrl": "0dc2fb4c-baf1-4a30-0df4-58de94f34d2f",
            "resource": {
                "resourceType": "Observation",
                "id": "JP-Observation-Example001",
                :
                <３個目の検査結果><省略>
                :
            }
        }
    ]
}
```

<br>

##### Bundle内のentryの識別子
Bundle.entry[] に繰り返しで格納される個々のリソース・インスタンスは、必ずBundle.entry[].fullUrl要素に、uuidをその都度毎回生成して設定<span style="color: red; ">しなければならない。</span>同じリソースインスタンスを別のBundleリソースにより再送する場合でも、前回使用したuuidを使用<span style="color: red; ">してはならない</span>（エラーにはならない）。
1回で送信するひとつのBundleインスタンスの中に同一のuuidが存在<span style="color: red; ">してはならない</span>（エラーとなる）。

このuuidによるBundle内のentryの識別子を、前回送信時の特定のentryの内容を受信側に指し示すための識別子として利用することはできない（受信側で保存しない）。

<br>

#### 送信済みBundleリソース・インスタンスを指定する識別子について

##### 対象となるBundleリソース・インスタンスの指定

６情報として送信した１報告単位のデータは、この単位で全体を削除するか、更新（削除＋新規登録）するかいずれかのみ行うことができる。<span style="color: red; ">１報告単位のデータのなかの特定のリソースだけを指定した削除や更新はできない。</span>
対象となる送信済みのBundleリソース・インスタンスの指定は、前述したBundleリソースを識別するIdentifier要素により行う。

##### 電子カルテ情報共有サービスでの削除と更新処理

　本節では、電子カルテ情報共有サービスを単に「共有サービス」と記載する。

  1. 削除処理：
    削除処理要求では、削除要求コマンドが、①被保険者個人識別子、
    ②Bundle.identifier.system値、③Bundle.identifier.value値、の3つのパラメータとともに送信される。削除対象となるBundleリソースそのものを送信しない。
    共有サービスでは、①②③がすべて一致するBundleリソース・インスタンスのデータを削除する。
  1. 更新処理：
    更新処理要求では、更新処理要求コマンドが、新しいBundleリソース・インスタンスのデータが、①被保険者個人識別子、②Bundle.identifier.system値、③Bundle.identifier.value値、の3つのパラメータとともにともに送信される。<br>
    共有サービスでは、①②③がすべて一致するBundleリソース・インスタンスのデータを削除する。<br>
    次に、送信されたBundleリソース・インスタンスのデータを登録する。

なお、共有サービスでは、削除処理、更新処理のどの過程でも途中で失敗、エラーとなった場合には、全ての処理をロールバックし、処理前の状態に戻す。

以上の共有サービス側の処理要件を満たせるよう、６情報の各リソースインスタンスには、送信側の責任で適切に①②③を設定<span style="color: red; ">しなければならない。</span>


#### Bundleリソースの送信タイミング

【本項は特に暫定的な記載である】


Bundleリソースの電子カルテ情報サービスへの送信タイミングについては、電子カルテ情報サービスの運用ルールに従うため、本IGの範囲外であるが、おおよそ以下の方針を前提として本IGは作成されている。

① アレルギー情報および薬剤禁忌情報　AllergyIntoleranceリソース、および　② 傷病名情報 Conditionリソース<br>

　　送信タイミングは、外来受診（複数診療科同日受診は１回とみなす）、入院、退院のイベントのあった日、およびこれらの情報が「新規登録または一部が更新、削除」（以下、「更新等」という）された時点ごととする。

③ 検査結果情報および感染症情報　Observationリソース、および　④ 処方依頼情報　MedicationRequestリソース<br>

　　送信タイミングは、これらの情報が更新等された時点ごととする。

また、上記における各日、各時点について、何時間以内とするかの取り決めは、本IGでは規定していないが、各日、各時点についてはそれぞれのイベント日時から２４時間以内を想定している。


#### 検体検査結果情報における検査項目のコーディング

##### はじめに

6情報のうち、検体検査結果情報と感染症情報はObservationリソースタイプを使用し、「eCS 診療情報・サマリー汎用 Observationリソース（検体検査結果／感染症検体検査結果）プロファイル」に準拠してデータを作成する必要がある。

以降では次の用語を使用する。
 - 臨床検査項目基本コードセット：　別に厚生労働省が定める、6情報の「臨床検査項目基本コードセット」の表。[臨床検査項目基本コードセット一覧(Excel)](laboitemset_20231104.xlsx)
 - 感染症検査項目リスト:  別に厚生労働省が定める「6情報における感染症検査項目リスト」の表。上記エクセルのシート参照。
 - FHIR検査項目情報： Observation.code.coding[n]に設定されるsystem, code, displayの３つの値。([n]は繰り返し可能なcoding要素のいずれかひとつのcoding要素を指す)
 - 共有項目JLACコード： 臨床検査項目基本コードセット、または感染症検査項目リスト　の<span style="color: red; ">どちらかに収載されている</span>検査項目のJLAC10コード。測定法コード部分3桁（13-15桁）が998（測定法問わず）または999（その他の測定法）であるJLAC10コードも含む。
 - 一般項目JLACコード： 臨床検査項目基本コードセット、と感染症検査項目リスト　の<span style="color: red; ">いずれにも収載されていない</span>検査項目のJLAC10コード。測定法コード部分3桁（13-15桁）が998（測定法問わず）または999（その他の測定法）であるJLAC10コードも含む。
 - 施設固有コード: 検査項目に施設固有のコードを割り当てたコード。
 - 未標準化コード：　すべて9からなる17桁のコード（<span style="color: blue; ">99999999999999999</span>）。
 - FHIR識別名 : 臨床検査項目基本コードセット、または感染症検査項目リスト　に収載されている項目の「FHIR識別名」

 display要素、text要素には、半角カタカナ文字、全角空白、制御文字（タブ、改行など）を含んではいけない。<span style="color: red; ">カタカナは必ず全角文字とすること。</span>英数字記号および空白は半角文字とすること。全角ギリシャ文字、全角ローマ数字は可。機種やOS依存文字は含まないこと。

##### 「FHIR検査項目情報」の設定パターンについて
 - （１）施設固有コード設定パターン<br>
   検査項目コードと名称を、Observationリソースのcode.coding[n]に以下のように設定する。<br>
    - code.coding[n].system : ”http://jpfhir.jp/fhir/clins/CodeSystem/JP_CLINS_ObsLabResult_LocalCode_CS”
      - 本来は施設ごとに異なるsystem値にすべきであるが、本仕様では施設によらずこの固定値を設定すること。
    - code.coding[n].code :　その施設固有の検査項目コード（いわゆるローカルコード）。異なる検体材料に同じ検査項目コードの検査が実施される施設の場合には、原則として検査項目コードに続けて"_"と検体材料の施設固有コードを連結した文字列とすることで、検体材料もわかるようなコードとすること。コード文字列中に英数字、ハイフン、アンダーバー以外の文字を含まないこと。
    - code.coding[n].display :　その施設での検査項目名。空白を含まない、なるべく長い文字列名称を推奨する。短い略称と長い略称がある選べる場合には、長い略称文字列を推奨する。異なる検体材料に同じ検査項目名の検査が実施されるシステムの場合には、原則として検査項目名に続けて"_"（半角アンダーバーこ）と検体材料名称を連結した文字列とすることで、検体材料もわかるようにすること（例："総蛋白_髄液"）。

 - （２）共有項目JLACコード設定パターン<br>
   検査項目コードと名称を、code.coding[n]に以下のように設定する。<br>
    - code.coding[n].system :　<br>
      - 臨床検査項目基本コードセットの検査項目：
      : ”http://jpfhir.jp/fhir/clins/CodeSystem/JP_CLINS_ObsLabResult_CoreLabo_CS”
      - 感染症検査項目リストの検査項目：
      : ”http://jpfhir.jp/fhir/<span style="color: blue;">clins/</span>CodeSystem/JP_CLINS_ObsLabResult_InfectionLabo_CS”
    - code.coding[n].code :　共有項目JLACコード
    - code.coding[n].display :　FHIR識別名

 - （３）一般項目JLACコード設定パターン<br>
   検査項目コードと名称を、code.coding[n]に以下のように設定する。<br>
    - code.coding[n].system :　”urn:oid:1.2.392.200119.4.504” (MEDIS臨床検査項目コード17桁(JLAC10)”http://medis.or.jp/CodeSystem/master-JLAC10-17digits”に対応するOID)
    - code.coding[n].code :　一般項目JLACコード
    - code.coding[n].display :　検査項目名。（JLACコードに対応する標準検査項目名称は定義されていないため、施設固有の検査項目名を用いて構わない。またJLAC10コードには検体材料コード情報が含まれているので、検体材料名称はなくても構わない。）

 - （４）未標準化コード設定パターン<br>
   検査項目コードと名称を、code.coding[n]に以下のように設定する。<br>
    - code.coding[n].system : ”http://jpfhir.jp/fhir/clins/CodeSystem/JP_CLINS_ObsLabResult_Uncoded_CS”
    - code.coding[n].code :　未標準化コードを設定する。
    - code.coding[n].display :　"未標準化コード項目(JLAC)"　を検査項目に関わらず固定文字列で設定する。<br>

いずれのパターンの場合にも、code.textには、（４）施設固有コード設定パターンでdisplayに設定する名称を設定する。<br>

##### 「FHIR検査項目情報」の設定パターン適用規則

　すべての検体検査結果（感染症情報を含む）で、常に（１）施設固有コード設定パターンを適用したcode.coding[m]を記述する。<span style="color: red; ">（必須）</span><br>
　その上で、さらに追加として<br>

  1. 　臨床検査項目基本コードセット、または感染症検査項目リストの検査項目の場合：<br>
  （２）共有項目JLACコード設定パターン　で記述する。<span style="color: red; ">（必須）</span><br>
　　これに加えて、　（３）一般項目JLACコード設定パターン　も記述して差し支えない。<br>

  1. 　1以外の検査項目の場合：<br>
  （３）一般項目JLACコード設定パターン　を適用したcode.coding[n]を記述することを強く推奨する。しかし、これができない場合には、標準コード化できなかったことを明示的に記述するために、（４）未標準化コード設定パターン　を適用したcode.coding[n]を記述することが<span style="color: red; ">必須である。</span>すなわち、（３）か（４）のどちらかの設定パターン　を適用したcode.coding[n]を記述することになる。

###### 記述例

  1. 臨床検査項目基本コードセットに収載される血清カリウム（FHIR識別名 K）の結果報告の例：<br>
    説明<br>
    　3ー 5行　施設固有コードと名称による記述。　0198394は施設固有検査項目コード、082は材料コード。<br>
    　9ー12行　臨床検査項目基本コード（JLAC10）による記述。<br>
　　　14ー16行　JLAC10コードによる記述。ここでは、9行目と同一コード。<br>
　　　19行　コード化に依存しない検査項目名称。<br>


```
 1:  "code": {
 2:    "coding": [
 3:      {
 4:        "system": "http://jpfhir.jp/fhir/clins/CodeSystem/JP_CLINS_ObsLabResult_LocalCode_CS",
 5:        "code": "0198394_082",
 6:        "display": "血清K"
 7:      },
 8:      {
 9:        "code": "3H015000001826101",
10:        "system": "http://jpfhir.jp/fhir/clins/CodeSystem/JP_CLINS_ObsLabResult_CoreLabo_CS",
11:        "display": "K"
12:      },
13:      {
14:        "code": "3H015000002326101",
15:        "system": "urn:oid:1.2.392.200119.4.504",
16:        "display": "カリウム_血清_電位差測定_定量値"
17:      }
18:    ],
19:    "text": "血清カリウム"
20:  },

```


  1. 臨床検査項目基本コードセットにはない別の結果報告の例：<br>
    説明<br>
    　3ー 5行　施設固有コードと名称による記述(本仕様に従ったsystem値との組み合わせ記述)。　0180500は施設固有検査項目コード、023は材料コード。<br>
    　9ー12行　施設固有コードと名称による記述（元の施設固有system値による記述。なくてもよい）。<br>
　　　14ー16行　JAC10コードに変換できなかった（しなかった）ことを示す記述（必須）。<br>
　　　19行　コード化に依存しない検査項目名称。<br><br>


```
 1:  "code": {
 2:    "coding": [
 3:      {
 4:        "system": "http://jpfhir.jp/fhir/clins/CodeSystem/JP_CLINS_ObsLabResult_LocalCode_CS",
 5:        "code": "0180500_023",
 6:        "display": "ケトン体_尿"
 7:      },
 8:      {
 9:        "system": "http://jpfhir.jp/fhir/local/h.u-tokyo.ac.jp/laboratory/CodeSystem/loboratory-items",
10:        "code": "0180500",
11:        "display": "尿ケトン体"
12:      },
13:      {
14:        "code": "99999999999999999",
15:        "system": "http://jpfhir.jp/fhir/clins/CodeSystem/JP_CLINS_ObsLabResult_Uncoded_CS",
16:        "display": ”未標準化コード項目(JLAC)"
17:      }
18:    ],
19:    "text": "尿ケトン体"
20:  },

```


#### 感染症情報とそれ以外の検体検査結果情報の区別

6情報のうち、感染症情報とそれ以外の検体検査結果情報とは、同じObservationリソースタイプを使用し、同じProfile「Observationリソース（検体検査結果／感染症検体検査結果）プロファイル」に準拠してデータを作成する。<br>
両者の区別はcode.coding.system要素に設定される値で識別される。
<br>

#### アレルギー情報と薬剤禁忌情報の区別

6情報のうち、アレルギー情報と薬剤禁忌情報とは同じAllergyIntoleranceリソースタイプを使用し、同じProfile「AllergyIntoleranceリソース（アレルギー情報／薬剤禁忌）プロファイル」に準拠してデータを作成する。<br>
両者の区別はAllergyIntoleranceリソースデータのcategory要素とcriticality要素に設定される値の組み合わせの違いにより以下の表に従い処理される。


薬剤禁忌情報においてはcategory要素にmedication、criticality要素にhighを必ず設定することによる。利用側（電子カルテ情報共有サービス）はこの両方の条件が満たされた場合にのみ「薬剤禁忌情報」として扱、どちらかまたは両方が満たされない場合には薬剤禁忌情報ではなくアレルギー情報として取り扱う。

<div>
<table border="2"  style="border-collapse: collapse">
<tr><th>category要素</th><th>criticality要素</th><th>取り扱われる<br>6情報での種別</th></tr>
<tr><td>medication</td><td>high以外、または値なし（要素なし）</td><td>薬剤に対するアレルギー情報。<br>薬剤禁忌情報としては扱われない。</td></tr>
<tr><td>medication</td><td>high</td><td>薬剤禁忌情報</td></tr>
<tr><td>medication以外、または値なし（要素なし</td><td>いずれかの値、または値なし（要素なし）</td><td>薬剤薬剤以外の原因物質に対するアレルギー情報。<br>薬剤禁忌としては扱われない。禁忌情報</td></tr>
</table>
</div>

<br>

#### 被保険者個人識別子の格納
電子カルテ情報共有サービスに医療機関から送信する場合には、個人識別子として、保険者情報と被保険者情報を送信することが必須である。このためFHIRリソースの患者情報であるPatientリソースのidentifier要素にこの識別子情報を設定<span style="color: red; ">しなければならない。</span><br>以下にその仕様を示す。<br>
なお、Patientリソースは、６情報のいずれでもBundleリソース内の先頭のentryに記述<span style="color: red; ">しなければならない。</span>またそのPatientリソースのidentifier要素にこの被保険者個人識別子を設定<span style="color: red; ">しなければならない。</span>

##### 「被保険者個人識別子」の文字列仕様
個人識別子として、保険者情報と被保険者情報とを以下の仕様で連結したひとつの文字列を使用する。<br>
本仕様では、以下、これを「被保険者個人識別子」と称する。また英数字は１バイト系文字の英数字を指す。<br>
被保険者個人識別子:　以下の各情報（要素）を半角コロン（文字コード１６進数 5A）で結合する。<br>
要素を省略する、とある場合には、長さ０の文字列とする。<br>

 - 保険者等番号:　<br>
 英数字８桁　保険者番号。８桁に満たない場合は、先頭に半角ゼロを追加して８桁とする。<br>
　　（保険者等番号とは、保険者番号または公費負担者番号を指す）<br><br>
 - 被保険者証（手帳）等の記号:　<br>
 英数または全角文字。健康保険被保険者証、船員保険被保険者証、受給資格者票及び国民健康保険被保険者証等の「記号及び番号」欄の記号を記録する。全角だけからなる文字列または半角だけからなる文字列のどちらかとする。英数字だけの場合には 1 バイト系（半角）文字だけから構成するか、または全角文字だけから構成する。記号または仮名漢字を含む場合には、英数字を含めすべて全角文字だけから構成する。なお、いずれの場合にも、全角空白を含めないこととする。被保険者証（手帳）等の番号だけしかない場合には、本要素は省略する。<br><br>
 - 被保険者証（手帳）等の番号:　<br>
 英数または全角文字。健康保険被保険者証、船員保険被保険者証、受給資格者票及び国民健康保険被保険者証等の「記号及び番号」欄の番号、または後期高齢者被保険者証の被保険者番号を記録する。全角だけからなる文字列または半角だけからなる文字列のどちらかとする。英数字だけの場合には 1 バイト系（半角）文字だけから構成するか、または全角文字だけから構成する。記号または仮名漢字を含む場合には、英数字を含めすべて全角文字だけから構成する。なお、いずれの場合にも、全角空白を含めないこととする。<br><br>
 - 被保険者証等枝番: <br>
 「被保険者証等枝番」に対応する文字列。半角数字2桁固定とする。枝番がない（表記されていない）場合には、00とするのではなく本要素は省略する。<br>
<br>
例）保険者等番号＝12345、被保険者証（手帳）等の記号＝あいう、被保険者証（手帳）等の番号＝１８７、枝番＝05 の場合、<br>
　　被保険者個人識別子＝ "00012345:あいう:１８７:05" となる。<br>
　被保険者証（手帳）等の記号と枝番がない場合には<br>
　　被保険者個人識別子＝ "00012345::１８７:" となる。この場合、最後のコロンは必須である。<br><br>

##### 被保険者個人識別子の格納方法
被保険者個人識別子は、Patientリソースのidentifier要素のvalueに記述する。この場合、system値には、「被保険者個人識別子」であることを示す「http://jpfhir.jp/fhir/eCS/Idsysmem/JP_Insurance_memberID」を設定する。<br>


```
    {
      "resourceType": "Patient",
      "id": "Patient1",
        <省略>
      "identifier": [
        {
          "system": "urn:oid:1.2.392.100495.20.3.51.11234567890",
          "value": "12345"
        },
        {http://jpfhir.jp/fhir/eCS/Idsysmem/JP_Insurance_memberID
          "system": "http://jpfhir.jp/fhir/clins/Idsystem/JP_Insurance_member",
          "value": "00012345:あいう:１８７:05"
        }
      ],
      "name": [
        <省略>
```


#### 長期保存の対象であることのフラグ情報の格納
電子カルテ情報共有サービスに医療機関から送信する場合、送信するFHIRリソースが長期保存対象の情報である場合には、そのことを明示的に示すため、>それぞれのリソース識別子情報を設定<span style="color: red; ">しなければならない</span>。<br>以下にその仕様を示す。<br>

##### 長期保存情報の仕様
リソースのデータを長期保存対象とする場合には、そのリソースのデータにおけるmeta要素のtag要素に以下の形式で記述<span style="color: red; ">しなければならない。</span><br>
　meta.tag.system = "http://jpfhir.jp/fhir/clins/CodeSystem/JP_ehrshrs_indication"　(この固定値とする)<br>
　meta.tag.code = "LTS"　(この固定値とする)<br>


```
{
  "resourceType": "AllergyIntolerance",
  "id": "Example-allergy",
  "meta": {
    :
    <省略>
    :
    "tag": {[
      {
        "system": "http://jpfhir.jp/fhir/clins/CodeSystem/JP_ehrshrs_indication",
        "code": "LTS"
      }
    ]
    }

  },
```

#### 病名情報における【未告知病名】であることのフラグ情報の格納
【未告知病名】とは、電子カルテ病名の登録済みの病名であるが、医療者がその病気の説明をまだ患者本人に対して病名やその病状を十分に説明していない段階であり、この病名情報を患者に提供する際には特別の配慮を必要とするものとして、電子カルテの病名登録画面上で、「未告知病名」として登録してある（または同様の意味あいのフラグを付与してある）病名情報のことである。
電子カルテ情報共有サービスに医療機関からこの病名情報を送信する場合、送信する病名FHIRリソースにそのことを明示的に示すため、特別なリソース識別子情報を設定<span style="color: red; ">しなければならない。</span><br>以下にその仕様を示す。<br>

##### 【未告知病名】情報の仕様
病名リソース（Conditionリソース）におけるmeta要素のtag要素に以下の形式で記述<span style="color: red; ">しなければならない。</span><br>
　meta.tag.system = "http://jpfhir.jp/fhir/clins/CodeSystem/JP_ehrshrs_indication"　(この固定値とする)<br>
　meta.tag.code = "UNINFORMED"　(この固定値とする)<br>


```
{
  "resourceType": "Condition",
  "id": "Example-condition",
  "meta": {
    :
    <省略>
    :
    "tag": {[
      {
        "system": "http://jpfhir.jp/fhir/clins/CodeSystem/JP_ehrshrs_indication",
        "code": "UNINFORMED"
      }
    ]
    }

  },
```

検体検査結果を未説明であることを示したい場合にも同じフラグを使用できるが、電子カルテ共有サービスでどのように取り扱われるかについては決定していない。
<br>


{% include markdown-link-references.md %}

